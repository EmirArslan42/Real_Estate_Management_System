<div class="container mt-4 mb-4">
    <h2 class="text-center">Alan Hesaplama</h2>
    <div class="btn-group mb-3">
        <button class="btn btn-primary" (click)="mode='manual'">Manuel</button>
        <button class="btn btn-secondary" (click)="loadAutoSelect()" >Auto</button>
    </div>

    <div *ngIf="mode=='manual'">
        <h5>Manuel Alan Hesaplama</h5>
        <p>A, B, C alanlarını harita üzerinden çiziniz.</p>
    </div>

    <div *ngIf="mode=='manual'">
        <h6>Manuel Alan İşlemleri</h6>
        <div class="btn-group mb-2 gap-2">
            <button class="btn btn-outline-warning" [disabled]="!manualAreas.A.geometry || !manualAreas.B.geometry" (click)="calculateIntersection('A','B')">
                A ∩ B
            </button>
            <button class="btn btn-outline-info" [disabled]="!manualAreas.A.geometry || !manualAreas.B.geometry" (click)="calculateIntersection('B','A')">
                B ∩ A
            </button>
            <button class="btn btn-outline-primary" [disabled]="!manualAreas.A.geometry || !manualAreas.B.geometry" (click)="calculateUnionAB()">
                A ∪ B
            </button>
            <button class="btn btn-outline-success"  [disabled]="!manualAreas.A.geometry || !manualAreas.B.geometry || !manualAreas.C.geometry" (click)="calculateUnionABC()">
                A ∪ B ∪ C
            </button>
        </div>
    </div>

    <div *ngIf="mode=='auto'">
        <h5>Otomatik Alan Hesaplama</h5>
        <p>Sistemdeki taşınmazlar üzerinden hesaplama yapılır.</p>
        <h6>Otomatik Alan İşlemleri</h6>
        <div class="btn-group mb-2 gap-2">
            <button class="btn btn-outline-warning" [disabled]="!manualAreas.A.geometry || !manualAreas.B.geometry" (click)="calculateIntersection('A','B')">
                A ∩ B
            </button>
            <button class="btn btn-outline-info" [disabled]="!manualAreas.A.geometry || !manualAreas.B.geometry" (click)="calculateIntersection('B','A')">
                B ∩ A
            </button>
            <button class="btn btn-outline-primary" [disabled]="!manualAreas.A.geometry || !manualAreas.B.geometry" (click)="calculateUnionAB()">
                A ∪ B
            </button>
            <button class="btn btn-outline-success"  [disabled]="!manualAreas.A.geometry || !manualAreas.B.geometry || !manualAreas.C.geometry" (click)="calculateUnionABC()">
                A ∪ B ∪ C
            </button>
        </div>
    </div>

    <div class="">
        <button class="btn btn-primary m-2" (click)="getTotalArea()">Toplam Alanı Göster</button>
        <button class="btn btn-primary" (click)="resetAreas()">Hesaplamaları Temizle</button>
    </div>

    <p><b>Toplam Hesaplanan Alan:</b> {{ formatArea(alan)}}</p>

    <div *ngIf="currentOperation" class="alert alert-info mt-3">
        <b>İşlem:</b> {{ currentOperation }} <br />
        <b>Alan:</b> {{ formatArea(alan) }}
    </div>

    <div class="map-legend">
        <div><span class="box a"></span> A Alanı</div>
        <div><span class="box b"></span> B Alanı</div>
        <div><span class="box c"></span> C Alanı</div>
        <div><span class="box intersection"></span> Kesişim (A ∩ B)</div>
        <div><span class="box union"></span> Birleşim (A ∪ B)</div>
        <div><span class="box union"></span> Birleşim (A ∪ B ∪ C)</div>
    </div>


    <app-tasinmaz-map [mode]="mode" [disableDraw]="maxDrawReached" [resetCounter]="resetCounter"
        (geometryDrawn)="onGeometryDrawn($event)" [resultGeometry]="geometryResult"></app-tasinmaz-map>

        <hr />

        <h5>Kaydedilmiş Alan Analizi Sonuçları</h5>

        <button class="btn btn-outline-dark mb-2" (click)="loadSavedResults()">
        Kaydedilmiş Sonuçları Getir
        </button>

        <table class="table table-bordered table-hover" *ngIf="savedResults.length > 0">
        <thead class="table-light">
            <tr>
            <th>Ad</th>
            <th>İşlem</th>
            <th>Alan</th>
            <th>Haritada Göster</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let result of savedResults">
            <td>{{ result.name }}</td>
            <td>{{ result.operation }}</td>
            <td>{{ formatArea(result.area) }}</td>
            <td>
                <button class="btn btn-sm btn-primary" (click)="showResultOnMap(result)">
                Göster
                </button>
            </td>
            </tr>
        </tbody>
        </table>

        <p *ngIf="savedResults.length === 0" class="text-muted">
        Henüz kaydedilmiş bir sonuç yok.
        </p>

</div>